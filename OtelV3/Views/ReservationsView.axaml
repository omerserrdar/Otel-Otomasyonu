<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:OtelV3.ViewModels"
             xmlns:models="using:OtelV3.Models"
             xmlns:mi="using:Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="OtelV3.Views.ReservationsView"
             x:DataType="vm:ReservationsViewModel"
             Background="{DynamicResource PageBackground}">

    <UserControl.Resources>
        <!-- Specialized Colors for this View (Cyan Theme from HTML) -->
        <Color x:Key="CyanPrimary">#11b4d4</Color>
        <Color x:Key="CyanPrimaryDark">#0e9ab5</Color>
        
        <SolidColorBrush x:Key="CyanPrimaryBrush" Color="{StaticResource CyanPrimary}" />
        <SolidColorBrush x:Key="CyanPrimaryDarkBrush" Color="{StaticResource CyanPrimaryDark}" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Input Style -->
        <Style Selector="TextBox.modernInput">
            <Setter Property="BorderBrush" Value="{DynamicResource InputBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Background" Value="{DynamicResource InputBackground}" />
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="14" />
        </Style>
        <Style Selector="TextBox.modernInput:focus">
            <Setter Property="BorderBrush" Value="{StaticResource CyanPrimaryBrush}" />
            <Setter Property="Background" Value="{DynamicResource CardBackground}" />
        </Style>

        <!-- CalendarDatePicker Style -->
        <Style Selector="CalendarDatePicker">
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="Background" Value="{DynamicResource InputBackground}" />
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}" />
            <Setter Property="BorderBrush" Value="{DynamicResource InputBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="4" />
        </Style>
        
        <!-- Checkbox Style -->
        <Style Selector="CheckBox">
            <Setter Property="CornerRadius" Value="4" />
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto, *">
        <!-- Page Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24" ColumnDefinitions="*, Auto">
            <StackPanel HorizontalAlignment="Center">
                <TextBlock Text="Rezervasyonlar" FontSize="32" FontWeight="Black" Foreground="{DynamicResource PrimaryText}" HorizontalAlignment="Center" />
                <TextBlock Text="Tüm rezervasyon işlemlerini yönetin ve takip edin." FontSize="16" Foreground="{DynamicResource SecondaryText}" Margin="0,4,0,0" HorizontalAlignment="Center" />
            </StackPanel>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Bottom">

                
                <Button Background="{StaticResource CyanPrimaryBrush}" CornerRadius="8" Padding="20,10" Command="{Binding NewReservationCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <mi:MaterialIcon Kind="Plus" Width="20" Height="20" Foreground="White" />
                        <TextBlock Text="Yeni Rezervasyon" FontWeight="Bold" Foreground="White" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Content (Sidebar + Table) -->
        <Grid Grid.Row="1" ColumnDefinitions="300, *">
            
            <!-- Left Filter Sidebar -->
            <ScrollViewer Grid.Column="0" Margin="0,0,24,0">
                <StackPanel Spacing="24">
                    <!-- Search Filter -->
                    <Border Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="12" Padding="20" BoxShadow="0 1 2 0 #0D000000">
                        <StackPanel Spacing="16">
                            <TextBlock Text="Hızlı Arama" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" />
                            <Grid>
                                <mi:MaterialIcon Kind="AccountSearch" Width="20" Height="20" Foreground="{DynamicResource SecondaryText}" Margin="12,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Center" ZIndex="1"/>
                                <TextBox Classes="modernInput" Watermark="Misafir adı veya ID..." Text="{Binding SearchText}" Padding="40,8,12,8" />
                            </Grid>
                        </StackPanel>
                    </Border>
                    
                    <!-- Date Filter -->
                    <Border Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="12" Padding="20" BoxShadow="0 1 2 0 #0D000000">
                        <StackPanel Spacing="16">
                            <TextBlock Text="Tarih Aralığı" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" />
                            <StackPanel Spacing="12">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Giriş Tarihi" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource SecondaryText}" />
                                    <CalendarDatePicker SelectedDate="{Binding FilterCheckInDate}" Watermark="Tarih seçin" />
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Çıkış Tarihi" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource SecondaryText}" />
                                    <CalendarDatePicker SelectedDate="{Binding FilterCheckOutDate}" Watermark="Tarih seçin" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Status Filter -->
                    <Border Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="12" Padding="20" BoxShadow="0 1 2 0 #0D000000">
                        <StackPanel Spacing="16">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Text="Durum" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" VerticalAlignment="Center" />
                                <Button Grid.Column="1" Content="Temizle" Background="Transparent" Foreground="{StaticResource CyanPrimaryBrush}" FontSize="12" FontWeight="Bold" Command="{Binding ClearFiltersCommand}" Padding="8,4" Margin="0" VerticalAlignment="Center"/>
                            </Grid>
                            <StackPanel Spacing="12">
                                <CheckBox IsChecked="{Binding FilterStatusConfirmed}" Content="Onaylandı" Foreground="{DynamicResource SecondaryText}" />
                                <CheckBox IsChecked="{Binding FilterStatusPending}" Content="Beklemede" Foreground="{DynamicResource SecondaryText}" />
                                <CheckBox IsChecked="{Binding FilterStatusCheckedIn}" Content="Giriş Yaptı" Foreground="{DynamicResource SecondaryText}" />
                                <CheckBox IsChecked="{Binding FilterStatusCheckedOut}" Content="Çıkış Yaptı" Foreground="{DynamicResource SecondaryText}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Room Type Filter -->
                    <Border Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="12" Padding="20" BoxShadow="0 1 2 0 #0D000000">
                        <StackPanel Spacing="16">
                            <TextBlock Text="Oda Tipi" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" />
                            <ComboBox ItemsSource="{Binding RoomTypes}" SelectedItem="{Binding SelectedRoomTypeFilter}" HorizontalAlignment="Stretch" CornerRadius="8" Padding="12,8" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
            
            <!-- Main Table Area -->
            <Border Grid.Column="1" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="12" BoxShadow="0 1 2 0 #0D000000" ClipToBounds="True">
                <Grid RowDefinitions="Auto, *, Auto">
                    <!-- Toolbar -->
                    <Border Grid.Row="0" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1" Padding="16">
                        <Grid ColumnDefinitions="Auto, *, Auto">
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <TextBlock Text="Gösterilen:" FontSize="14" FontWeight="Medium" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" />
                                <ComboBox ItemsSource="{Binding PageSizeOptions}" SelectedItem="{Binding ItemsPerPage}" BorderThickness="0" Background="{DynamicResource CardBackgroundAlt}" FontWeight="Bold" CornerRadius="4" Padding="8,4" />
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <Button Classes="iconBtn" Command="{Binding RefreshCommand}" Background="Transparent" Padding="8">
                                    <mi:MaterialIcon Kind="FilterList" Foreground="{DynamicResource SecondaryText}" />
                                </Button>
                                <Button Classes="iconBtn" Command="{Binding RefreshCommand}" Background="Transparent" Padding="8">
                                    <mi:MaterialIcon Kind="Refresh" Foreground="{DynamicResource SecondaryText}" />
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Table Header -->
                    <Grid Grid.Row="1" VerticalAlignment="Top" Height="48" Background="{DynamicResource CardBackgroundAlt}" ColumnDefinitions="100,2*,1.5*,1.5*,100,120,60">
                        <TextBlock Grid.Column="0" Text="#ID" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="24,0,0,0" />
                        <TextBlock Grid.Column="1" Text="MİSAFİR" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="12,0,0,0" />
                        <TextBlock Grid.Column="2" Text="ODA" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="12,0,0,0" />
                        <TextBlock Grid.Column="3" Text="GİRİŞ / ÇIKIŞ" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="12,0,0,0" />
                        <TextBlock Grid.Column="4" Text="TUTAR" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="12,0,0,0" />
                        <TextBlock Grid.Column="5" Text="DURUM" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="12,0,0,0" />
                        <TextBlock Grid.Column="6" Text="İŞLEM" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,24,0" />
                    </Grid>
                    
                    <!-- Table List -->
                    <ListBox Grid.Row="1" Margin="0,48,0,0" ItemsSource="{Binding Reservations}" Background="Transparent" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.Styles>
                            <Style Selector="ListBoxItem">
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0" />
                                <Setter Property="Background" Value="Transparent" />
                            </Style>
                            <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="#0D11b4d4" />
                            </Style>
                            <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                <Setter Property="Background" Value="Transparent" />
                            </Style>
                        </ListBox.Styles>
                        
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="models:ReservationModel">
                                <Border BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,1,0,0" Padding="0,16">
                                    <Grid ColumnDefinitions="100,2*,1.5*,1.5*,100,120,60">
                                        <!-- ID -->
                                        <TextBlock Grid.Column="0" Text="{Binding Id}" FontWeight="Medium" Foreground="{DynamicResource SecondaryText}" VerticalAlignment="Center" Margin="24,0,0,0" />
                                        
                                        <!-- Guest -->
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" Margin="12,0,0,0">
                                            <Border Width="32" Height="32" CornerRadius="16" Background="{DynamicResource BorderBrush}" ClipToBounds="True">
                                                <Panel>
                                                    <TextBlock Text="{Binding GuestInitials}" FontWeight="Bold" FontSize="12" Foreground="{DynamicResource SecondaryText}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                    <!-- Ideally Image control here if URL exists -->
                                                </Panel>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding GuestName}" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" FontSize="14" />
                                                <TextBlock Text="{Binding GuestContact}" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Room -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="12,0,0,0">
                                            <TextBlock FontWeight="Medium" Foreground="{DynamicResource PrimaryText}" FontSize="14">
                                                <Run Text="{Binding RoomNumber}" />
                                                <Run Text=" - " />
                                                <Run Text="{Binding RoomType}" />
                                            </TextBlock>
                                            <TextBlock Text="{Binding GuestCount}" FontSize="12" Foreground="{DynamicResource SecondaryText}" />
                                        </StackPanel>
                                        
                                        <!-- Dates -->
                                        <StackPanel Grid.Column="3" VerticalAlignment="Center" Spacing="2" Margin="12,0,0,0">
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <mi:MaterialIcon Kind="Login" Width="14" Height="14" Foreground="#22c55e" />
                                                <TextBlock Text="{Binding FormattedCheckIn}" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource PrimaryText}" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <mi:MaterialIcon Kind="Logout" Width="14" Height="14" Foreground="#f87171" />
                                                <TextBlock Text="{Binding FormattedCheckOut}" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource SecondaryText}" />
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Amount -->
                                        <TextBlock Grid.Column="4" Text="{Binding FormattedAmount}" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" FontSize="14" VerticalAlignment="Center" Margin="12,0,0,0" />
                                        
                                        <!-- Status -->
                                        <Border Grid.Column="5" Background="{Binding StatusBackground}" CornerRadius="12" Padding="10,4" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="12,0,0,0">
                                            <TextBlock Text="{Binding StatusText}" Foreground="{Binding StatusForeground}" FontWeight="Bold" FontSize="12" />
                                        </Border>
                                        
                                        <!-- Actions -->
                                        <Button Grid.Column="6" Padding="4" Background="Transparent" HorizontalAlignment="Right" Margin="0,0,24,0">
                                            <mi:MaterialIcon Kind="DotsVertical" Foreground="{DynamicResource SecondaryText}" />
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- Footer - Simplified -->
                    <Grid Grid.Row="2" ColumnDefinitions="*, Auto" Margin="16" >
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="Toplam " Foreground="{DynamicResource SecondaryText}" />
                            <TextBlock Text="{Binding Reservations.Count}" FontWeight="Bold" Foreground="{DynamicResource PrimaryText}" />
                            <TextBlock Text=" rezervasyon listeleniyor" Foreground="{DynamicResource SecondaryText}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
